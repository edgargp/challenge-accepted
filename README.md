# platform-challenge-accepted

## How to run application locally

To be able to run the application locally make sure 
- you have docker & docker-compose installed
- ports 5000,6000,7000,6379,80 are not used by other processes

After that run `docker compose up` in the folder.
You should see 5 containers up and running.

Congratulations!


## Quickstart

### 1) `POST /token` - Create an authentication token

Create an authentication token for the given user. Tokens are valid for **30 seconds**.

```bash
$ http -v POST http://localhost:5000/token \
  username=alice \
  password=password
```


### 2) `POST /transaction` - Create a transaction

A valid authentication token generated by the [Auth API](../auth-api) is required. The `enabled` property of a user must be `true`.

Remember that authentication tokens are valid for **30 seconds**.

```bash
$ http -v POST http://localhost:5000/transaction \
  amount=100 \
  currency=USD \
  token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoxLCJ1c2VybmFtZSI6ImFsaWNlIiwiZW5hYmxlZCI6dHJ1ZSwiZXhwIjoxNjM1ODg0NzkzfQ.t4fLg-F8Ev3nwDED18OiQaqCOCzG7bgIO0s1AbFoRZo
```

**After the last command you should see Job OK in platform-challenge-psp-connector logs**


## Architecture Overview

```
+----------------------------------+
|            Merchant              |
+-+--------^------------+--------^-+
  |        |            |        |
 (1)      (2)          (3)      (5)
  |        |            |        |
+-v--------+-+        +-v--------+-+        +-----------------+
|  Auth API  |        |  Core API  |        |  PSP Connector  | 
+------------+        +------+-----+        +---------^-------+
                             |                        |
                            (4)                      (6)
                             |                        |
                      +------v------------------------+-------+
                      |          Redis Message Queue          |
                      +---------------------------------------+
```

There are 3 distinct services:

- [Auth API] - Creates authentication tokens to valid users.
- [Core API] - Processes transaction requests.
- [PSP Connector] - Processes the transactions with a Payment Service Provider (PSP).

A transaction flow is as follows:

1. A merchant authenticates with the [Auth API] by providing a valid username and password.
2. An authentication token that is valid for 30 seconds is returned.
3. Use this authentication token to make a transaction request to the [Core API].
4. The [Core API] submits the transaction to a message queue for further background processing.
5. A successful response is returned.
6. Meanwhile, a [PSP Connector] processes the transaction from the message queue by connecting to a Payment Service Provider.

We use environment variables to configure a service.
